# Change Log

RA2 INI Assistant 版本变更日志

### 1.2.0 (2025-12-28) - 当前版本

**✨ 新增功能**:
- 官方 RenameProvider 批量重命名，带预览和范围选择（索引/当前文件/全工作区），预览支持横向滚动
- 未定义/未使用节诊断与快速修复（创建缺失节、删除未用节），跨文件索引可用
- 注册表助手：跨文件节名补全、节头快速注册 CodeAction，支持 append / keyValue 模式与默认值
- 索引与缓存状态查看命令，输出文件/节/引用/缓存命中等统计

**🔧 改进**:
- TranslationLoader 自动合并字段并初始化 registerType，避免硬编码缺项
- 诊断系统：注册表节自动排除，跨文件引用大小写不敏感，已注册值视为“已使用”；索引变更后自动刷新已打开文档诊断，消除初始化蓝线滞后
- 索引器支持白名单过滤与大小写不敏感查找，实时更新（保存/打开/编辑/删除）

**📋 命令更新**:
- 新增：`INI: 批量重命名（预览）`，`INI: 查看索引与缓存状态`

---

### 1.1.0 (2025-12-22)

**✨ 新增功能**:
- ✅ **词典补充** 
  - 现在已加入ARES和phobos扩展平台的大部分词典
  - 补充调整部分原版遗漏错误的词典
- ✅ **webView预览词典和一键插入配置功能** 
  - `Ctrl+Shift+A 打开窗口`
  - 筛选功能：所有 / 显示原版 / ARES / Phobos
  - 点击右上角按钮即时切换，占位文本实时显示当前筛选状态
  - 显示键名、平台、分类、类型、章节等详细信息
  - 支持三种插入格式：仅键、键=、注释说明
  - 一键插入到编辑器，自动检测重复定义
- ✅ **文件统计** 
  - 当前文件统计/工作区统计
  - 具体文件名/文件数量，总节数，总键值数，重复使用的键提示

**🔧 改进**:
- 优化了快速搜索的数据加载和渲染性能
- 补充了部分错漏的词典和翻译，并优化去重和排序算法
- 优化了类型推断逻辑，使其推断的类型更准确
- 优化了格式化功能，现在可以自动补全缺失的括号了
- 优化了部分索引逻辑降低性能消耗
- 修复了作用域颜色有时失效的bug，修复了类型推断失效问题，修复了格式化某些情况下无效的问题，修复了某些情况下注释可能引起的报错提醒，还有若干个bug和调整（其实是不记得了

**📋 命令更新**:
- 快捷键新增：`Ctrl+Shift+A`

**📦 项目维护**:
- 清理了其他无效文件，整理代码
- 删除了旧版本 VSIX 包
- 项目结构更加整洁


## [1.0.0] - 2025-12-20

### ✨ 新增功能

#### 核心编辑功能
- **智能代码补全** - 输入键名时自动提供中文说明和类型感知补全
- **跨文件引用导航** - Ctrl+Click 跳转到节定义，Shift+F12 查找所有引用
- **增强悬浮提示** - 详细显示键/节的信息、引用位置和跨文件定义
- **动态类型推断** - 通过注册列表和引用关系自动推断节的类型
- **代码折叠** - 按节名折叠代码块，快速定位和组织大型配置文件

#### 语法检查
- **重复定义检测** - 自动检测同一节内的重复键名（不区分大小写）
- **语法错误检测** - 检测缺失等号、`+=` 操作符使用错误、空值问题
- **实时诊断** - 文档变化时自动检测（500ms防抖）

#### 代码格式化
- **自动排序** - 对数字键（如 `1=`、`2=`、`123=`）按升序排列
- **保留顺序** - 非数字键（如 `Name=`、`Primary=`）保持原有顺序
- **+=支持** - 正确识别和排序追加操作符
- **智能间距** - 可配置节之间的空行数（0-50行）

#### 代码片段与可视化
- **272+ RA2单位与建筑代码片段** - 完整的美苏阵营单位/建筑配置模板库
- **多语言触发支持** - 支持英文代码、中文名称、拼音全称和拼音首字母缩写触发
  - 示例：`E1` 美国大兵 → 可通过 `e1`、`meiguo`、`mg` 快速插入配置模板
- **彩色作用域装饰** - 为每个节块显示淡色背景，按彩虹色区分不同节（支持开关）
- **概览标尺** - 右侧滚动条用色块标记不同节位置，便于快速导航

#### 架构优化
- **模块化设计** - 代码分离为 types、indexManager、translationLoader、typeInference、diagnostics
- **多文件索引** - 支持跨多个INI文件的节名和引用关系索引
- **性能优化** - 文件大小限制、白名单机制、防抖处理

### 🔧 改进

- 优化了类型推断引擎算法
- 改进了数字键排序的精确度（避免 "01" 这样的伪数字）
- 增强了跨文件索引的查询性能
- 完善了错误处理和日志输出（使用 outputChannel 而非 console）
- 修复了 currentSection 命名方式导致排序失效的问题

### 📚 文档

- 完整的 README 使用指南（包含使用技巧）
- 详细的配置选项说明和表格化呈现
- 技巧和最佳实践指南
- 贡献指南和反馈渠道
- 完整的版本历史记录

### 🎨 代码质量

- ✅ 通过 ESLint 代码风格检查（0 errors）
- ✅ TypeScript 严格模式编译通过
- ✅ 完整的类型注解和 JSDoc 注释
- ✅ 统一的代码风格（curly braces、缩进等）

### 📦 项目元数据

- 更新 package.json：版本号、描述、发布者、许可证、仓库等完整信息
- 添加关键词便于搜索发现
- 配置项优化和默认值调整：
  - `enableScopeDecorations` - 彩色作用域装饰开关（默认启用）
  - `enableMultiFileSearch` - 跨文件搜索开关
  - `maxEmptyLinesBetweenSections` - 节间空行数
  - `relatedFiles` - 关联文件白名单
  - `maxFileSize` - 单文件大小限制
- 命令面板命令完整性检查
- Snippets 文件 (`snippets/ini.json`) 纳入发布包

### ⚠️ 注意事项

- 默认跳过超过 5MB 的文件以避免性能问题（可配置）
- 部分 MOD 专用键可能没有收录，欢迎提交补充
- 词典基于红警2原版和尤里的复仇

---

## [0.0.1] - Initial Release

- 初始发布版本（仅内部开发使用）

---

**完整变更**: [LufeiQD/RA2-INI-Assistant](https://github.com/LufeiQD/RA2-INI-Assistant)